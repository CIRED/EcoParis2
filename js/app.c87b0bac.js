(function(t){function e(e){for(var r,s,i=e[0],l=e[1],c=e[2],d=0,p=[];d<i.length;d++)s=i[d],n[s]&&p.push(n[s][0]),n[s]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(t[r]=l[r]);u&&u(e);while(p.length)p.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],r=!0,i=1;i<a.length;i++){var l=a[i];0!==n[l]&&(r=!1)}r&&(o.splice(e--,1),t=s(s.s=a[0]))}return t}var r={},n={app:0},o=[];function s(e){if(r[e])return r[e].exports;var a=r[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=r,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(a,r,function(e){return t[e]}.bind(null,r));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var u=l;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"0466":function(t,e,a){},"054f":function(t,e,a){"use strict";var r=a("fcd1"),n=a.n(r);n.a},"2a3c":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("cadf"),a("551c"),a("097d");var r=a("2b0e"),n=function(){var t=this,e=this,a=e.$createElement,r=e._self._c||a;return r("div",{attrs:{id:"app"}},[r("transition",{attrs:{name:"fade"}},[e.introVisible?r("Intro",{attrs:{onDismiss:function(){e.introVisible=!1,t.currentLayerPath=t.defaultLayer}}}):e._e()],1),r("section",{staticClass:"menu"},[r("LocationControl",{attrs:{onLocation:function(e){return t.currentLocation=e}}}),r("Layers",{attrs:{layers:e.layers},model:{value:e.currentLayerPath,callback:function(t){e.currentLayerPath=t},expression:"currentLayerPath"}}),r("ZoomControl")],1),r("section",{staticClass:"container"},[r("Map",{attrs:{layers:e.layers,currentLayerPath:e.currentLayerPath,currentLocation:e.currentLocation,onHist:function(e,a){t.currentHistogramX=e,t.currentHistogramY=a},onSchools:function(t){},appRefs:this.$refs}}),r("svg",{ref:"circle_svg",staticClass:"EV-circle-svg"}),r("svg",{ref:"svg",staticClass:"EV-svg"}),r("div",{ref:"legend",staticClass:"color_legend"}),r("Sidebar",{attrs:{layers:e.layers,currentLayerPath:e.currentLayerPath,EV_path:e.EV_path,currentHistogramX:e.currentHistogramX,currentHistogramY:e.currentHistogramY}})],1)],1)},o=[],s=(a("ac6a"),a("456d"),a("7dc5")),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"intro"},[t._m(0),a("p",[t._v("Découvrez l'influence de la nature sur votre vie à Paris.")]),a("section",{staticClass:"buttons"},[a("a",{staticClass:"button accent",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.onDismiss(e)}}},[t._v("Commencer")]),a("a",{staticClass:"button",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.onDismiss(e)}}},[t._v("Visite guidée")])])])},l=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h1",[t._v("\n    EcoParis\n    "),a("img",{attrs:{src:"assets/parrot.svg"}})])}],c={props:["onDismiss"]},u=c,d=(a("91fa"),a("2877")),p=Object(d["a"])(u,i,l,!1,null,null,null);p.options.__file="Intro.vue";var h=p.exports,f=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},m=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"zoom-control"},[a("a",{staticClass:"minus",attrs:{href:"#"}},[t._v("-")]),a("a",{staticClass:"plus",attrs:{href:"#"}},[t._v("+")])])}],v={},g=v,y=(a("bf1e"),Object(d["a"])(g,f,m,!1,null,null,null));y.options.__file="ZoomControl.vue";var _=y.exports,b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"location-control"},[a("a",{staticClass:"locate",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.locate(e)}}},[a("i",{staticClass:"fas fa-map-marker-alt"})]),a("div",{class:{search:!0,active:t.searchExpanded}},[a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.toggleSearch(e)}}},[t.searchExpanded?a("i",{staticClass:"fas fa-search-minus"}):a("i",{staticClass:"fas fa-search-location"})]),a("input",{ref:"searchInput",staticClass:"autocomplete",attrs:{type:"text"},on:{keyup:function(e){if(!("button"in e)&&27!==e.keyCode)return null;t.searchExpanded=!1}}})])])},C=[],x={props:["onLocation"],data:function(){return{searchExpanded:!1}},mounted:function(){var t=this,e=new google.maps.places.Autocomplete(this.$refs.searchInput);e.setFields(["geometry"]),e.setOptions({strictBounds:!0}),e.setBounds({north:s.viewport.topLatitude,south:s.viewport.bottomLatitude,west:s.viewport.leftLongitude,east:s.viewport.rightLongitude}),e.addListener("place_changed",function(){var a=e.getPlace();a.geometry?(t.searchExpanded=!1,t.onLocation([a.geometry.location.lat(),a.geometry.location.lng()])):t.onLocation(null,null)})},methods:{locate:function(){var t=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){t.onLocation([e.coords.latitude,e.coords.longitude])})},toggleSearch:function(){this.searchExpanded^=!0,this.$refs.searchInput.focus()},keypressSearch:function(t){alert(JSON.stringify(t))}}},E=x,P=(a("bed8"),Object(d["a"])(E,b,C,!1,null,null,null));P.options.__file="LocationControl.vue";var V=P.exports,w=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"layers"},[a("h3",[t._v("Couches")]),a("div",{staticClass:"buttons"},t._l(t.layers,function(e){return e.hidden?t._e():a("a",{class:{active:t.value==e.path},on:{click:function(a){a.preventDefault(),t.select(e)}}},[a("span",{staticClass:"icon",domProps:{innerHTML:t._s(e.icon)}}),a("span",[t._v(t._s(e.name))]),e.loaded?t._e():a("div",{staticClass:"loader-tile-grid"},[a("div",{staticClass:"loader-tile loader-tile1"}),a("div",{staticClass:"loader-tile loader-tile2"}),a("div",{staticClass:"loader-tile loader-tile3"}),a("div",{staticClass:"loader-tile loader-tile4"}),a("div",{staticClass:"loader-tile loader-tile5"}),a("div",{staticClass:"loader-tile loader-tile6"}),a("div",{staticClass:"loader-tile loader-tile7"}),a("div",{staticClass:"loader-tile loader-tile8"}),a("div",{staticClass:"loader-tile loader-tile9"})])])}))])},k=[],S={props:["layers","value"],methods:{select:function(t){t.loading||this.$emit("input",t.path)}}},j=S,I=(a("054f"),Object(d["a"])(j,w,k,!1,null,null,null));I.options.__file="Layers.vue";var T=I.exports,O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{ref:"map",staticClass:"map"})},B=[],H=a("3835"),M=a("d7c2"),D=a("83da"),$=a("ddd3"),z=a("f856"),G=a("e0b1"),A=function(t,e,a,r,n,o,i,l,c){G.interComm_shape=o,G.voronoi_shape=i,G.onHistChange=l,G.onSchools=c,G.legend_element=r;var u=new L.LatLng(s.viewport.topLatitude,s.viewport.leftLongitude),d=new L.LatLng(s.viewport.bottomLatitude,s.viewport.rightLongitude);function p(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){M.setLocation(t.coords.latitude,t.coords.longitude)})}G.initialBounds=L.latLngBounds(u,d),G.color_legend_canvas=d3.select(r).append("canvas"),G.color_legend_svg=d3.select(r).append("svg"),G.color_legend_svg.append("g"),p(),M.createMap(t),L.geoJson(o,{style:M.blankStyle}).addTo(G.map);var h=d3.select(t).select(".leaflet-zoom-animated");function f(t,e){var a=G.map.latLngToLayerPoint(new L.LatLng(e,t));this.stream.point(a.x,a.y)}var m=d3.geo.transform({point:f});G.pathGenerator=d3.geo.path().projection(m);var v=h.append("defs");G.defs_path=v.append("path").attr("id","clip_path"),v.append("clipPath").attr("id","clip").append("use").attr("xlink:href","#clip_path"),G.imgs=h.selectAll("image").data([0]).enter().append("svg:image").attr("x",0).attr("y",0).attr("xlink:href","").attr("clip-path",""),D.update_clip();var g=0,y=.4,_=1;G.svg_EV=d3.select(e).attr("style","display:none;"),G.svg_circle_EV=d3.select(a).attr("style","display:none;"),G.imgs_EV=G.svg_EV.selectAll("image").data([0]).enter().append("svg:image").attr("x",0).attr("y",0).attr("xlink:href","");var b=G.svg_EV.append("g");return b.selectAll("path").data([o.features[0]]).enter().append("path").attr("vector-effect","non-scaling-stroke").style("stroke","#000").style("fill-opacity",0).style("stroke-opacity",1),G.voronoi=z.defineVoronoi(h,g,_),G.interComms=z.defineInterComms(h,g,y,_),G.markerIcon={iconUrl:"assets/marker.png",iconSize:[24,24],iconAnchor:[12,24]},G.markerElement=h.append("g").selectAll("image").data([0]).enter().append("svg:image").attr("xlink:href",G.markerIcon.iconUrl).attr("width",G.markerIcon.iconSize[0]).attr("height",G.markerIcon.iconSize[1]).attr("visibility","hidden").style("pointer-events","none"),G.canvas=document.createElement("canvas"),G.update_parameters={hide:!0},G.map.on("viewreset",function(){D.updateMap()}),[$.loadLayer,$.setLayer,M.setLocation,$.setEVLayer]},F={props:["layers","currentLayerPath","currentLocation","onHist","onSchools","appRefs","onSchools"],data:function(){return{loadLayer:function(){},setLayer:function(){},setLocation:function(){}}},mounted:function(){var t=this,e="data/intercommunalites.geojson",a="data/voronois.json";queue().defer(d3.json,e).defer(d3.json,a).await(function(e,a,r){var n=A(t.$refs.map,t.appRefs.svg,t.appRefs.circle_svg,t.appRefs.legend,e,a,r,t.onHist,t.onSchools),o=Object(H["a"])(n,5);t.loadLayer=o[0],t.setLayer=o[1],t.setLocation=o[2],t.setEVLayer=o[3],t.setTextUrban=o[4],Object.keys(s.layers).forEach(function(e){t.layers[e].path=e,t.loadLayer(e,function(){t.layers[e].loaded=!0,e==s.EV_path&&t.setEVLayer(e)})}),t.setLayer(t.currentLayerPath)})},watch:{currentLayerPath:function(t){this.setLayer(t)},currentLocation:function(t){var e=Object(H["a"])(t,2),a=e[0],r=e[1];this.setLocation(a,r)}}},R=F,Y=(a("894b"),Object(d["a"])(R,O,B,!1,null,null,null));Y.options.__file="Map.vue";var N=Y.exports,X=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"sidebar"},[t.currentLayerPath&&t.layers[t.currentLayerPath].loaded?a("div",[a("h2",[t._v(t._s(t.layers[t.currentLayerPath].title))]),a("div",{domProps:{innerHTML:t._s(t.layers[t.currentLayerPath].content)}}),t.currentLayerPath!=t.EV_path?a("Histogram",{attrs:{x:t.currentHistogramX,y:t.currentHistogramY}}):t._e()],1):a("div",{staticClass:"split"},[t._m(0),t._m(1)])])},U=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("article",[a("h2",[t._v("Bienvenue sur EcoParis.")]),a("p",[t._v("EcoParis est une visualisation interactive des données cartographiques des services écosystémiques en territoires urbains et péri-urbains en région Ile-de-France issues du projet "),a("a",{attrs:{href:"https://idefese.wordpress.com/"}},[t._v("IDEFESE")]),t._v(".")]),a("p",[t._v("Pour commencer, vous pouvez sélectionner une couche à afficher parmi des mesures de rétention "),a("a",{attrs:{href:"#"}},[t._v("de phosphore")]),t._v(" et "),a("a",{attrs:{href:"#"}},[t._v("d'azote")]),t._v(", des mesures de "),a("a",{attrs:{href:"#"}},[t._v("réduction de la température")]),t._v(" due à la végétation ou encore de "),a("a",{attrs:{href:"#"}},[t._v("valeur économique")]),t._v(" des régions.")]),a("p",[t._v("Vous pouvez aussi choisir d'afficher l'évolution estimée de ces mesures à l'horizon 2025 dans un scénario de changement climatique.")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("article",{staticClass:"about"},[a("p",[t._v("EcoParis a été conçu par des élèves du cours de "),a("a",{attrs:{href:"https://edu.epfl.ch/coursebook/en/data-visualization-COM-480"}},[t._v("Data Visualization")]),t._v(" de l'EPFL, avec l'aide de Perrine Hamel du projet "),a("a",{attrs:{href:"https://naturalcapitalproject.stanford.edu/"}},[t._v("Natural Capital Project")]),t._v(" de Stanford.")]),a("section",{staticClass:"slideshow"},[a("a",{attrs:{href:"https://www.epfl.ch/"}},[a("img",{attrs:{src:"https://mediacom.epfl.ch/files/content/sites/mediacom/files/EPFL-Logo.jpg",alt:"Logo EPFL"}})]),a("a",{attrs:{href:"https://naturalcapitalproject.stanford.edu/"}},[a("img",{attrs:{src:"https://idefese.files.wordpress.com/2018/11/image5.jpg?w=172&h=171",alt:"Logo NatCap"}})])])])}],q=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"graph",staticClass:"graph-box"})},J=[],Z=function(t){Plotly.react(t.$refs.graph,[{x:t.x,y:t.y,type:"histogram",histfunc:"sum",xbins:{end:256,size:1,start:0}}],{margin:{l:35,r:35,t:5,b:20}},{displayModeBar:!1})},W={props:["x","y"],mounted:function(){Z(this)},watch:{x:function(){Z(this)}}},K=W,Q=(a("cd26"),Object(d["a"])(K,q,J,!1,null,null,null));Q.options.__file="Histogram.vue";var tt=Q.exports,et={props:["layers","currentLayerPath","EV_path","currentHistogramX","currentHistogramY"],components:{Histogram:tt}},at=et,rt=(a("f203"),Object(d["a"])(at,X,U,!1,null,null,null));rt.options.__file="Sidebar.vue";var nt=rt.exports,ot=s.EV_path,st={data:function(){return{layers:Object.keys(s.layers).reduce(function(t,e){return t[e]=s.layers[e],t[e].loaded=!1,t[e].path=e,t},{}),currentLayerPath:null,currentLocation:null,currentHistogramX:null,currentHistogramY:null,introVisible:!0,sidebarVisible:!1,defaultLayer:ot,EV_path:s.EV_path}},components:{Intro:h,ZoomControl:_,LocationControl:V,Layers:T,Map:N,Sidebar:nt}},it=st,lt=(a("5c0b"),Object(d["a"])(it,n,o,!1,null,null,null));lt.options.__file="App.vue";var ct=lt.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(t){return t(ct)}}).$mount("#app")},"58be":function(t,e,a){},"5c0b":function(t,e,a){"use strict";var r=a("5e27"),n=a.n(r);n.a},"5e27":function(t,e,a){},"7dc5":function(t){t.exports={layers:{"data/rasters/espaces_verts.json":{name:"Esp. verts",icon:"E",colorScheme:0,useColorScheme:!1,colors:["#00ff00","#0000ff","#008800"],min_value:0,max_value:0,title:"Espaces verts.",content:"<p>[texte espaces verts]</p>"},"data/rasters/pollination_cc.json":{name:"Phosph.",icon:"P",colorScheme:1,useColorScheme:!0,min_value:0,max_value:5,title:"Mesure de la rétention de phosphore.",content:"<p>Le service de rétention du phosphore permet d'améliorer la qualité de l'eau (superficielle et souterraine). Il est directement utile aux organismes de gestion de l'eau (syndicats et département d'assainissement), et donc aux habitants dont les impôts financent la maintenance des services d'assainissement.</p>"},"data/rasters/T_reduction.json":{name:"Nitrog.",icon:"N",colorScheme:0,useColorScheme:!0,min_value:-5,max_value:5,title:"Mesure de la rétention d'azote.",content:"<p>Le service de rétention de l'azote permet d'améliorer la qualité de l'eau (superficielle et souterraine). Il est directement utile aux organismes de gestion de l'eau (syndicats et département d'assainissement), et donc aux habitants dont les impôts financent la maintenance des services d'assainissement.</p>"},"data/rasters/ecoles_elementaires.json":{name:"Ecoles elementaires",icon:"E",colorScheme:0,useColorScheme:!0,min_value:0,max_value:0,title:"Nombre d'écoles élémentaires et maternelles",content:"<p>Should not appear anyway, find something to fill here.</p>",hidden:!0}},viewport:{topLatitude:49.23719070644322,bottomLatitude:48.12054154281846,leftLongitude:1.44727950476602,rightLongitude:3.555686958558566},EV_path:"data/rasters/espaces_verts.json",Ecole_path:"data/rasters/ecoles_elementaires.json",Urban_cooling:"data/rasters/T_air_ref.json","":"1 - blue-green"}},"83da":function(t,e,a){var r=a("7dc5"),n=a("d7c2"),o=a("e0b1");e.update_clip=function(){var t=o.map,e=o.cachedLayers,a=o.currentLayerPath,r=o.defs_path;function n(r,n){var o=t.latLngToLayerPoint([e[a].tl_lat,e[a].tl_lng]),s=t.latLngToLayerPoint([e[a].br_lat,e[a].br_lng]),i=s.x-o.x,l=s.y-o.y,c=t.latLngToLayerPoint(L.latLng(n,r)),u=(c.x-o.x)/(s.x-o.x)*(i-1),d=(c.y-o.y)/(s.y-o.y)*(l-1);this.stream.point(u,d)}var s=d3.geo.transform({point:n}),i=d3.geo.path().projection(s);r.attr("d",i)},e.update_EV_preview=function(t,e){var a=o.svg_EV,n=o.map,s=o.cachedLayers,i=o.imgs_EV,l=r.EV_path;if(s[r.EV_path]){a.style("width").substr(0,a.style("width").length-2);var c=parseInt(a.style("width").substr(0,a.style("width").length-2)),u=parseInt(a.style("height").substr(0,a.style("width").length-2));a.attr("style","top:"+(e-u-30)+"; left:"+(t-c/2)+"; display:'';"),o.svg_circle_EV.attr("style","top:"+(e-u/2)+"; left:"+(t-c/2)+"; display:'';");var d=L.latLng(s[l].tl_lat,s[l].tl_lng),p=L.latLng(s[l].br_lat,s[l].br_lng),h=n.latLngToContainerPoint(d),f=(n.latLngToContainerPoint(p),n.latLngToLayerPoint(p).x-n.latLngToLayerPoint(d).x),m=n.latLngToLayerPoint(p).y-n.latLngToLayerPoint(d).y;i.attr("width",f),i.attr("height",m),i.attr("transform","translate("+(+h.x-t+c/2)+","+(+h.y-e+u/2)+")")}},e.update_chart=function(t,e,a){var r=o.cachedLayers,s=r[e];if(s){var i=[];i=1==a?s.voronoi_hist[t]:s.interComm_hist[t],i[0]=0,o.onHistChange(n.range(256),i)}},e.update_text_school=function(t,e,a){var n=o.cachedLayers;if(e==r.Urban_cooling){var s=n[r.Ecole_path];if(!s)return;var i=[];i=1==a?s.voronoi_hist[t]:s.interComm_hist[t],o.onSchools(i)}else o.onSchools(null)},e.updateMarker=function(){var t=o.map,e=o.currentGeoLat,a=o.currentGeoLng,r=o.markerElement;if(e&&a){var n=t.latLngToLayerPoint([e,a]),s=n.x-o.markerIcon.iconAnchor[0],i=n.y-o.markerIcon.iconAnchor[1];r.attr("visibility","visible"),r.attr("transform","translate(".concat(s,", ").concat(i,")"))}else r.attr("visibility","hidden")},e.updateMap=function(){var t=o.map,a=(o.cachedLayers,o.voronoi),r=o.interComms,n=o.imgs,s=o.imgs_EV,i=o.update_parameters,l=o.pathGenerator;if(i.hide)return console.log("hidden!"),r.attr("visibility","hidden"),a.attr("visibility","hidden"),n.attr("visibility","hidden"),void s.attr("visibility","hidden");r.attr("visibility","visible"),a.attr("visibility","visible"),n.attr("visibility","visible"),s.attr("visibility","visible");var c=i.tl,u=i.br;console.log("UPDATING");var d=t.latLngToLayerPoint(u).x-t.latLngToLayerPoint(c).x,p=t.latLngToLayerPoint(u).y-t.latLngToLayerPoint(c).y;n.attr("transform",function(e){var a=t.latLngToLayerPoint(c);return"translate("+a.x+","+a.y+")"}),n.attr("width",d),n.attr("height",p),r.attr("d",l),a.attr("d",l),e.update_clip(),e.updateMarker(),o.svg_EV.attr("style","display:none;"),o.svg_circle_EV.attr("style","display:none;")}},"894b":function(t,e,a){"use strict";var r=a("a130"),n=a.n(r);n.a},"91fa":function(t,e,a){"use strict";var r=a("a90f"),n=a.n(r);n.a},a130:function(t,e,a){},a90f:function(t,e,a){},bed8:function(t,e,a){"use strict";var r=a("2a3c"),n=a.n(r);n.a},bf1e:function(t,e,a){"use strict";var r=a("d162"),n=a.n(r);n.a},cd26:function(t,e,a){"use strict";var r=a("58be"),n=a.n(r);n.a},d162:function(t,e,a){},d7c2:function(t,e,a){var r={0:d3.interpolateRdYlBu,1:d3.interpolateBuGn,2:d3.interpolateCool},n=a("e0b1");e.loadContainmentFile=function(t){return fetch(t).then(function(t){return t.json()}).then(function(t){return t.data=JSON.parse(t.data),t})};var o="https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",s='&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';function i(t){return interComm_shape.features.some(function(e){return d3.geoContains(e,t)})}e.createMap=function(t){n.map=L.map(t,{zoomControl:!1});var e=n.map;e.fitBounds(n.initialBounds);var a=L.tileLayer(o,{minZoom:9,maxZoom:14,attribution:s});a.addTo(e)},e.setLocation=function(t,e){t&&e&&i([e,t])?(n.map.setZoom(11),n.map.panTo(new L.LatLng(t,e))):(t=null,e=null,n.map.fitBounds(n.initialBounds)),n.currentGeoLat=t,n.currentGeoLng=e,update_f.updateMarker()},e.getColorsFromScheme=function(t){for(var e=r[t],a=[],n=0;n<256;++n)a.push(e(n/255));return a},e.fillScale=function(t,e,a,r,n){for(var o=200,s=80,i={top:10,right:40,bottom:10,left:2},l=t.attr("height",o-i.top-i.bottom).attr("width",1).style("height",o-i.top-i.bottom+"px").style("width",s-i.left-i.right+"px").style("border","1px solid #000").style("position","absolute").style("top",i.top+"px").style("left",i.left+"px").node(),c=l.getContext("2d"),u=function(t){return a((o-i.top-i.bottom-t)/(o-i.top-i.bottom)*255)},d=c.createImageData(1,o-i.top-i.bottom),p=0;p<o-i.top-i.bottom;++p){var h=d3.rgb(u(p));d.data[4*p]=h.r,d.data[4*p+1]=h.g,d.data[4*p+2]=h.b,d.data[4*p+3]=255}c.putImageData(d,0,0);var f=d3.axisRight().scale(d3.scaleLinear().domain([n,r]).range([1,o-i.bottom-i.top])).tickSize(6).ticks(8),m=e.attr("height",o+"px").attr("width",s+"px").style("position","absolute").style("left","0px").style("top","0px");m.select("g").attr("class","axis").attr("transform","translate("+(s-i.left-i.right+3)+","+i.top+")").call(f)},e.computeColorRange=function(t,e){var a=t.slice();a.unshift(0),a.push(255);for(var r=a.length,n=e.length,o=[],s=0;s<n;++s)o[s]=s/(n-1);var i=d3.scale.linear().domain(o).range(e),l=[];for(s=0;s<r;++s){var c=s/(r-1);l.push(i(c))}return[a,l]},e.blankStyle=function(t){return{opacity:0,fillOpacity:0}},e.range=function(t){for(var e=[],a=0;a<t;++a)e[a]=a;return e}},ddd3:function(t,e,a){var r=a("7dc5"),n=a("d7c2"),o=a("e0b1"),s=a("83da");e.loadLayer=function(t,e){var a=o.canvas,s=o.voronoi_shape,i=o.interComm_shape;o.cachedLayers[t]?e():fetch(t).then(function(t){return t.json()}).then(function(l){l.data=JSON.parse(l.data),l.percentiles=JSON.parse(l.percentiles);var c=l.data;a.width=l.width,a.height=l.height;var u=a.getContext("2d");u.createImageData(a.width,a.height);for(var d=a.height*a.width,p=1,h=0,f=d/p,m=a.height/p,v=[],g=[],y={},_=0;_<s.features.length;++_){g[_]=0,v[_]=0,y[_]=[];for(var L=0;L<256;++L)y[_][L]=0}var b=[],C=[],x={};for(_=0;_<i.features.length;++_){C[_]=0,b[_]=0,x[_]=[];for(L=0;L<256;++L)x[_][L]=0}o.firstVoronoiByInterComm=[];var E=o.firstVoronoiByInterComm;for(_=0;_<i.features.length;++_)E[_]=1e4;var P=function(n){for(var c=n.data.result,d=n.data.index,f=n.data.interComm_counts,_=n.data.interComm_means,L=n.data.voronoi_counts,P=n.data.voronoi_means,V=n.data.firstVoronoiByInterComm,w=n.data.voronoi_hist,k=n.data.interComm_hist,S=0;S<s.features.length;++S){g[S]+=L[S],v[S]+=P[S];for(var j=0;j<256;++j)y[S][j]+=w[S][j]}for(S=0;S<i.features.length;++S){C[S]+=f[S],b[S]+=_[S];for(j=0;j<256;++j)x[S][j]+=k[S][j];E[S]>V[S]&&(E[S]=V[S])}if(u.putImageData(c,0,m*d),h++,h==p){if(t==r.Ecole_path){for(S=0;S<s.features.length;++S)v[S]/=255;for(S=0;S<i.features.length;++S)b[S]/=255}else{for(S=0;S<s.features.length;++S)0!=g[S]&&(v[S]/=g[S]);for(S=0;S<i.features.length;++S)0!=C[S]&&(b[S]/=C[S])}var I=[70,140],T=a.toDataURL("png");o.cachedLayers[t]={url:T,tl_lat:l.tl_lat,tl_lng:l.tl_lng,br_lat:l.br_lat,br_lng:l.br_lng,width:a.width,height:a.height,voronoi_means:v,interComm_means:b,voronoi_hist:y,interComm_hist:x,hist_buckets:I,percentiles:l.percentiles,layerUrl:t},e()}},V=n.range(256),w=[];if(r.layers[t].useColorScheme)w=n.getColorsFromScheme(r.layers[t].colorScheme);else{var k=n.computeColorRange(l.percentiles,r.layers[t].colors),S=k[0],j=k[1],I=d3.scale.linear().range(j).domain(S);for(_=0;_<256;++_){var T=d3.rgb(I(_));w.push("rgb("+T.r+","+T.g+","+T.b+")")}}n.loadContainmentFile("data/voronoi_cont.json").then(function(t){n.loadContainmentFile("data/intercomm_cont.json").then(function(e){for(var r=0;r<p;r++){var n=new Worker("assets/pictureProcessor.js");n.onmessage=P;var o=u.getImageData(0,m*r,a.width,m);n.postMessage({canvasData:o,pixels:c,index:r,length:f,width:a.width,height:a.height,voronoiContainmentData:t.data,interCommContainmentData:e.data,numVoronois:s.features.length,numInterComms:i.features.length,tl_lat:l.tl_lat,tl_lng:l.tl_lng,br_lat:l.br_lat,br_lng:l.br_lng,colorDomain:V,colorRange:w})}})})})},e.setLayer=function(t){var e=o.update_parameters,a=o.imgs;if(!t)return e.hide=!0,void s.updateMap();this.loadLayer(t,function(){t==r.EV_path?a.attr("clip-path",""):a.attr("clip-path","url(#clip)");var i=o.cachedLayers[t];e.tl=new L.LatLng(i.tl_lat,i.tl_lng),e.br=new L.LatLng(i.br_lat,i.br_lng),e.currentGeoLat=o.currentGeoLat,e.currentGaoLng=o.currentGeoLng;var l=[],c=[];if(r.layers[t].useColorScheme)l=n.range(256),c=n.getColorsFromScheme(r.layers[t].colorScheme);else{var u=n.computeColorRange(i.percentiles,r.layers[t].colors);l=u[0],c=u[1]}var d=d3.scale.linear().range(c).domain(l);o.voronoi.attr("fill",function(e,a){return t==r.EV_path?"#00000011":d(i.voronoi_means[a])}),o.interComms.attr("fill",function(e,a){return t==r.EV_path?"#00000011":d(i.interComm_means[a])}),o.canvas.width=i.width,o.canvas.height=i.height,e.hide=!1,s.updateMap(),o.currentLayerPath=t,a.attr("xlink:href",i.url),t==r.EV_path?d3.select(o.legend_element).style("display","none").style("border","1px solid #0000"):(n.fillScale(o.color_legend_canvas,o.color_legend_svg,d,r.layers[t].min_value,r.layers[t].max_value),d3.select(o.legend_element).style("background-color","#fff"),d3.select(o.legend_element).style("display","").style("border","1px solid #000"))})},e.setEVLayer=function(t){o.imgs_EV.attr("xlink:href",o.cachedLayers[r.EV_path].url)}},e0b1:function(t,e,a){"use strict";a.r(e);a("cadf"),a("551c"),a("097d");exports.cachedLayers={},exports.currentLayerPath="",exports.map=null,exports.currentGeoLat=null,exports.currentGeoLng=null,exports.svg_EV=null,exports.svg_circle_EV=null,exports.interComms=null,exports.voronoi=null,exports.imgs=null,exports.imgs_EV=null,exports.update_parameters={},exports.markerElement=null,exports.canvas=null,exports.voronoi_shape=null,exports.interComm_shape=null,exports.firstVoronoiByInterComm=[],exports.pathGenerator=null,exports.defs_path=null,exports.legend_element=null,exports.color_legend_canvas=null,exports.color_legend_svg=null,exports.onSchools=null,exports.onHistChange=null,exports.highligthedInterComm=-1,exports.initialBounds=null,exports.markerIcon={}},f203:function(t,e,a){"use strict";var r=a("0466"),n=a.n(r);n.a},f856:function(t,e,a){"use strict";a.r(e);a("cadf"),a("551c"),a("097d");var r=a("7dc5"),n=(a("d7c2"),a("e0b1")),o=a("83da");function s(t){function e(e,a){return n.firstVoronoiByInterComm[t]<=a&&(t==n.interComm_shape.features.length-1||n.firstVoronoiByInterComm[t+1]>a)?1:0}return e}exports.defineVoronoi=function(t,e,a){return t.append("g").selectAll("path").data(n.voronoi_shape.features).enter().append("path").attr("d",n.pathGenerator).attr("vector-effect","non-scaling-stroke").style("stroke","#666").style("fill-opacity",e).style("stroke-opacity",e).on("mouseover",function(t,a){d3.select(this).style("fill-opacity",e),n.defs_path.datum(t.geometry),o.update_clip(),o.update_chart(a,n.currentLayerPath,!0,n.onHistChange),o.update_text_school(a,n.currentLayerPath,!1,n.onSchools)}).on("mouseout",function(t,e){-1!=n.highlightedInterComm&&(d3.select(this).style("fill-opacity",s(n.highlightedInterComm)(t,e)),d3.select(this).style("stroke-opacity",s(n.highlightedInterComm)(t,e))),n.defs_path.datum([]),o.update_clip(),n.svg_EV.attr("style","display:none;"),n.svg_circle_EV.attr("style","display:none;")}).on("click",function(t,r){n.interComms.style("pointer-events","all"),n.map.fitBounds(n.initialBounds),n.highlightedInterComm=-1,n.interComms.style("fill-opacity",a),n.voronoi.style("fill-opacity",e),n.voronoi.style("stroke-opacity",e),n.defs_path.datum([]),o.update_clip(),n.svg_EV.attr("style","display:none;"),n.svg_circle_EV.attr("style","display:none;")}).on("mousemove",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&n.currentLayerPath!=r.EV_path?o.update_EV_preview(d3.event.layerX,d3.event.layerY):(n.svg_EV.attr("style","display:none;"),n.svg_circle_EV.attr("style","display:none;"))})},exports.defineInterComms=function(t,e,a,i){return t.append("g").selectAll("path").data(n.interComm_shape.features).enter().append("path").attr("d",n.path).attr("vector-effect","non-scaling-stroke").style("stroke","#333").attr("fill","#fff").attr("fill-opacity",i).style("pointer-events","all").on("mouseover",function(t,r){-1!=n.highlightedInterComm?r!=n.highlightedInterComm?d3.select(this).style("fill-opacity",i):d3.select(this).style("fill-opacity",e):d3.select(this).style("fill-opacity",a),o.update_chart(r,n.currentLayerPath,!0),o.update_text_school(r,n.currentLayerPath,!1)}).on("mouseout",function(t,r){-1!=n.highlightedInterComm?r==n.highlightedInterComm?d3.select(this).style("fill-opacity",e):d3.select(this).style("fill-opacity",a):d3.select(this).style("fill-opacity",i),n.svg_EV.attr("style","display:none;"),n.svg_circle_EV.attr("style","display:none;")}).on("click",function(t,r){n.interComms.style("pointer-events","all"),d3.select(this).style("pointer-events","none"),n.interComms.style("fill-opacity",a),d3.select(this).style("fill-opacity",e),n.highlightedInterComm=r,n.voronoi.style("fill-opacity",s(r)),n.voronoi.style("stroke-opacity",s(r));var o=d3.select(this).node().getBBox(),i=n.map.layerPointToLatLng(L.point(o.x,o.y)),l=n.map.layerPointToLatLng(L.point(o.x+o.width,o.y+o.height));n.map.fitBounds(L.latLngBounds(i,l)),n.svg_EV.attr("style","display:none;"),n.svg_circle_EV.attr("style","display:none;")}).on("mousemove",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&n.currentLayerPath!=r.EV_path?o.update_EV_preview(d3.event.layerX,d3.event.layerY):(n.svg_EV.attr("style","display:none;"),n.svg_circle_EV.attr("style","display:none;"))})}},fcd1:function(t,e,a){}});
//# sourceMappingURL=app.c87b0bac.js.map