(function(t){function e(e){for(var a,i,s=e[0],l=e[1],c=e[2],f=0,p=[];f<s.length;f++)i=s[f],r[i]&&p.push(r[i][0]),r[i]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);u&&u(e);while(p.length)p.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],a=!0,s=1;s<n.length;s++){var l=n[s];0!==r[l]&&(a=!1)}a&&(o.splice(e--,1),t=i(i.s=n[0]))}return t}var a={},r={app:0},o=[];function i(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=a,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(n,a,function(e){return t[e]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var u=l;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0466":function(t,e,n){},"054f":function(t,e,n){"use strict";var a=n("fcd1"),r=n.n(a);r.a},"0f8a":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("097d");var a=n("2b0e"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("transition",{attrs:{name:"fade"}},[t.introVisible?n("Intro",{attrs:{onDismiss:function(){return t.introVisible=!1}}}):t._e()],1),n("section",{staticClass:"menu"},[n("ZoomControl"),n("Layers",{model:{value:t.currentLayer,callback:function(e){t.currentLayer=e},expression:"currentLayer"}})],1),n("section",{staticClass:"container"},[n("Map",{attrs:{currentLayer:t.currentLayer}}),n("Sidebar",{attrs:{currentLayer:t.currentLayer}})],1)],1)},o=[],i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"intro"},[t._m(0),n("p",[t._v("How nature impacts your life in Paris.")]),n("a",{staticClass:"button",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.onDismiss(e)}}},[t._v("Explore")])])},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("h1",[t._v("\n    EcoParis\n    "),n("img",{attrs:{src:"assets/parrot.svg"}})])}],l={props:["onDismiss"]},c=l,u=(n("91fa"),n("2877")),f=Object(u["a"])(c,i,s,!1,null,null,null);f.options.__file="Intro.vue";var p=f.exports,d=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},h=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"zoom-control"},[n("a",{staticClass:"minus",attrs:{href:"#"}},[t._v("-")]),n("a",{staticClass:"plus",attrs:{href:"#"}},[t._v("+")])])}],m={},v=m,g=(n("f27d"),Object(u["a"])(v,d,h,!1,null,null,null));g.options.__file="ZoomControl.vue";var y=g.exports,_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"layers"},[n("h3",[t._v("Layers")]),n("div",{staticClass:"buttons"},[n("a",{class:{active:"data/p_export.json"==t.value},attrs:{href:"#"},on:{click:function(e){t.$emit("input","data/p_export.json")}}},[n("span",[t._v("P")]),t._v("\n      Phosph.\n    ")]),n("a",{class:{active:"data/n_export.json"==t.value},attrs:{href:"#"},on:{click:function(e){t.$emit("input","data/n_export.json")}}},[n("span",[t._v("N")]),t._v("\n      Nitrog.\n    ")])])])},b=[],x={props:["value"]},w=x,C=(n("054f"),Object(u["a"])(w,_,b,!1,null,null,null));C.options.__file="Layers.vue";var j=C.exports,k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{ref:"map",staticClass:"map"})},O=[],P=n("2909"),T=(n("ac6a"),n("28a5"),"https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png"),M='&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';function S(t,e){var n=L.map(t,{zoomControl:!1});n.fitBounds(e);var a=L.tileLayer(T,{minZoom:9,maxZoom:14,attribution:M});return a.addTo(n),n}function D(t){var e=null,n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(),200==n.status&&(e=n.responseText),e}function E(t){var e=D(t),n=JSON.parse(e);return n.data=JSON.parse(n.data),console.log(n),n}function I(t){return t>200?"e31a1c":t>150?"fc4e2a":t>100?"fd8d3c":t>50?"feb24c":"ffffcc"}var $=function(t,e,n,a){var r=0,o=0,i=new L.LatLng(49.2485668,1.4403262),s=new L.LatLng(48.1108602,3.5496114),l=L.latLngBounds(i,s),c=S(t,l);function u(t){return{opacity:0,fillOpacity:0}}L.geoJson(n,{style:u}).addTo(c);var f=d3.select(t).select("svg");function p(t,e){var n=c.latLngToLayerPoint(new L.LatLng(e,t));this.stream.point(n.x,n.y)}var d=d3.geo.transform({point:p}),h=d3.geo.path().projection(d),m=f.append("defs"),v=m.append("path").attr("id","clip_path");m.append("clipPath").attr("id","clip").append("use").attr("xlink:href","#clip_path");var g=f.selectAll("image").data([0]).enter().append("svg:image").attr("x",0).attr("y",0).attr("xlink:href","").attr("clip-path","url(#clip)");function y(){function t(t,e){var n=c.latLngToLayerPoint([Z[w].tl_lat,Z[w].tl_lng]),a=c.latLngToLayerPoint([Z[w].br_lat,Z[w].br_lng]),r=a.x-n.x,o=a.y-n.y,i=c.latLngToLayerPoint(L.latLng(e,t)),s=(i.x-n.x)/(a.x-n.x)*(r-1),l=(i.y-n.y)/(a.y-n.y)*(o-1);this.stream.point(s,l)}var e=d3.geo.transform({point:t}),n=d3.geo.path().projection(e);v.attr("d",n)}var _=0,b=.4,x=1,w="",C=f.append("g").selectAll("path").data(a.features).enter().append("path").attr("d",h).attr("vector-effect","non-scaling-stroke").style("stroke","#666").style("fill-opacity",_).style("stroke-opacity",_).on("mouseover",function(t,e){d3.select(this).style("fill-opacity",_),v.datum(t.geometry),y(),z(e,w,!0)}).on("mouseout",function(t,e){-1!=j&&(d3.select(this).style("fill-opacity",k(j)(t,e)),d3.select(this).style("stroke-opacity",k(j)(t,e))),v.datum([]),y()}).on("click",function(t,e){O.style("pointer-events","all"),c.fitBounds(l),j=-1,O.style("fill-opacity",x),C.style("fill-opacity",_),C.style("stroke-opacity",_),v.datum([]),y()}),j=-1;function k(t){function e(e,a){return U[t]<=a&&(t==n.features.length-1||U[t+1]>a)?1:0}return e}var O=f.append("g").selectAll("path").data(n.features).enter().append("path").attr("d",h).attr("vector-effect","non-scaling-stroke").style("stroke","#333").attr("fill","#4444").attr("fill-opacity",x).style("pointer-events","all").on("mouseover",function(t,e){-1!=j?e!=j?d3.select(this).style("fill-opacity",x):d3.select(this).style("fill-opacity",_):d3.select(this).style("fill-opacity",b),z(e,w,!1)}).on("mouseout",function(t,e){-1!=j?e==j?d3.select(this).style("fill-opacity",_):d3.select(this).style("fill-opacity",b):d3.select(this).style("fill-opacity",x)}).on("click",function(t,e){O.style("pointer-events","all"),d3.select(this).style("pointer-events","none"),O.style("fill-opacity",b),d3.select(this).style("fill-opacity",_),j=e,C.style("fill-opacity",k(e)),C.style("stroke-opacity",k(e));var n=d3.select(this).node().getBBox(),a=c.layerPointToLatLng(L.point(n.x,n.y)),r=c.layerPointToLatLng(L.point(n.x+n.width,n.y+n.height));c.fitBounds(L.latLngBounds(a,r))}),T={iconUrl:"assets/marker.png",iconSize:[24,24],iconAnchor:[12,24]},M=f.append("g").selectAll("image").data([0]).enter().append("svg:image").attr("xlink:href",T.iconUrl).attr("width",T.iconSize[0]).attr("height",T.iconSize[1]).style("pointer-events","none");function $(t){r=48.864716,o=2.349014;for(var e=0;e<n.features.length;++e)d3.geoContains(n.features[e],[o,r])&&1}$(null);var A=document.createElement("canvas"),B=(A.getContext("2d"),I(0),{});function z(t,e,n){var a=Z[e];if(a){if(1==n)var r=a.voronoi_hist[t];else r=a.interComm_hist[t];console.log(r);for(var o=[],i=0;i<a.hist_buckets.length+1;++i)o[i]=0;r.forEach(function(t,e){for(e=0;e<a.hist_buckets.length;++e)if(t<=a.hist_buckets[e])return void o[e]++;o[a.hist_buckets.length]++}),console.log(o)}}function J(){var t=B.tl,e=B.br,n=B.current_geoLat,a=B.current_geoLong;console.log("UPDATING");var r=c.latLngToLayerPoint(e).x-c.latLngToLayerPoint(t).x,o=c.latLngToLayerPoint(e).y-c.latLngToLayerPoint(t).y;g.attr("transform",function(e){var n=c.latLngToLayerPoint(t);return"translate("+n.x+","+n.y+")"}),g.attr("width",function(t){return r}),g.attr("height",function(t){return o}),O.attr("d",h),C.attr("d",h),y(),M.attr("transform",function(t){var e=c.latLngToLayerPoint([n,a]);return"translate("+(e.x-T.iconAnchor[0])+","+(e.y-T.iconAnchor[1])+")"})}var N=E("data/voronoi_cont.json"),V=E("data/intercomm_cont.json"),U=[],Z={};function q(t){if(console.log("SETTING LAYER",t),Z[t])S();else{var e=D(t),i=JSON.parse(e);i.data=JSON.parse(i.data);var s=i.data;A.width=i.width,A.height=i.height;var l=A.getContext("2d");l.createImageData(A.width,A.height);for(var c=A.height*A.width,u=1,f=0,p=c/u,d=A.height/u,h=[],m=[],v={},y=0;y<a.features.length;++y)m[y]=0,h[y]=0,v[y]=[];var _=[],b=[],x={};for(y=0;y<n.features.length;++y)b[y]=0,_[y]=0,x[y]=[];U=[];for(y=0;y<n.features.length;++y)U[y]=1e4;for(var j=function(e){for(var r=e.data.result,o=e.data.index,s=e.data.interComm_counts,c=e.data.interComm_means,p=e.data.voronoi_counts,y=e.data.voronoi_means,L=e.data.firstVoronoiByInterComm,w=e.data.voronoi_hist,C=e.data.interComm_hist,j=0;j<a.features.length;++j)m[j]+=p[j],h[j]+=y[j],v[j]=v[j].concat(w[j]);for(j=0;j<n.features.length;++j)b[j]+=s[j],_[j]+=c[j],x[j]=x[j].concat(C[j]),U[j]>L[j]&&(U[j]=L[j]);if(l.putImageData(r,0,d*o),f++,f==u){console.log("finished :",x[0].length);for(j=0;j<a.features.length;++j)0!=m[j]&&(h[j]/=m[j]);for(j=0;j<n.features.length;++j)0!=b[j]&&(_[j]/=b[j]);var k=[70,140],O=A.toDataURL("png");g.attr("xlink:href",O),Z[t]={url:O,tl_lat:i.tl_lat,tl_lng:i.tl_lng,br_lat:i.br_lat,br_lng:i.br_lng,width:A.width,height:A.height,voronoi_means:h,interComm_means:_,voronoi_hist:v,interComm_hist:x,hist_buckets:k,layerUrl:t},S()}},k=0;k<u;k++){var T=new Worker("assets/pictureProcessor.js");T.onmessage=j;var M=l.getImageData(0,d*k,A.width,d);T.postMessage({canvasData:M,pixels:s,index:k,length:p,width:A.width,height:A.height,voronoiContainmentData:N.data,interCommContainmentData:V.data,numVoronois:a.features.length,numInterComms:n.features.length,tl_lat:i.tl_lat,tl_lng:i.tl_lng,br_lat:i.br_lat,br_lng:i.br_lng})}}function S(){var e=Z[t],n=d3.scale.linear().range(["#ffffcc","#e31a1c"]).domain([Math.min.apply(Math,Object(P["a"])(e.voronoi_means)),Math.max.apply(Math,Object(P["a"])(e.voronoi_means))]);d3.scale.linear().range(["#ffffcc","#e31a1c"]).domain([Math.min.apply(Math,Object(P["a"])(e.interComm_means)),Math.max.apply(Math,Object(P["a"])(e.interComm_means))]);C.attr("fill",function(t,a){return n(e.voronoi_means[a])}),O.attr("fill",function(t,a){return n(e.interComm_means[a])}),A.width=e.width,A.height=e.height;var a=new L.LatLng(e.tl_lat,e.tl_lng),i=new L.LatLng(e.br_lat,e.br_lng);B.tl=a,B.br=i,B.current_geoLat=r,B.current_geoLong=o,J(),w=t,g.attr("xlink:href",e.url)}}return c.on("viewreset",J),q},A={props:["currentLayer"],data:function(){return{setLayer:function(){}}},mounted:function(){var t=this,e="data/intercommunalites.geojson",n="data/voronois.json";queue().defer(d3.json,e).defer(d3.json,n).await(function(e,n,a){t.setLayer=$(t.$refs.map,e,n,a),t.setLayer(t.currentLayer)})},watch:{currentLayer:function(t){this.setLayer(t)}}},B=A,z=(n("894b"),Object(u["a"])(B,k,O,!1,null,null,null));z.options.__file="Map.vue";var J,N,V=z.exports,U=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"sidebar"},["data/p_export.json"==t.currentLayer?n("div",[n("h2",[t._v("Mesure de la rétention de phosphore.")]),n("p",[t._v("Le service de rétention du phosphore permet d'améliorer la qualité de l'eau (superficielle et souterraine). Il est directement utile aux organismes de gestion de l'eau (syndicats et département d'assainissement), et donc aux habitants dont les impôts financent la maintenance des services d'assainissement.")]),n("DemoChart")],1):t._e(),"data/n_export.json"==t.currentLayer?n("div",[n("h2",[t._v("Mesure de la rétention de l'azote.")]),n("p",[t._v("Le service de rétention de l'azote permet d'améliorer la qualité de l'eau (superficielle et souterraine). Il est directement utile aux organismes de gestion de l'eau (syndicats et département d'assainissement), et donc aux habitants dont les impôts financent la maintenance des services d'assainissement.")]),n("DemoChart")],1):t._e()])},Z=[],q={extends:VueChartJs.Bar,mounted:function(){this.renderChart()}},G=q,R=Object(u["a"])(G,J,N,!1,null,null,null);R.options.__file="DemoChart.vue";var H=R.exports,W={props:["currentLayer"],components:{DemoChart:H}},X=W,Y=(n("f203"),Object(u["a"])(X,U,Z,!1,null,null,null));Y.options.__file="Sidebar.vue";var F=Y.exports,K={data:function(){return{currentLayer:"data/p_export.json",introVisible:!0,sidebarVisible:!1}},components:{Intro:p,ZoomControl:y,Layers:j,Map:V,Sidebar:F}},Q=K,tt=(n("5c0b"),Object(u["a"])(Q,r,o,!1,null,null,null));tt.options.__file="App.vue";var et=tt.exports;a["a"].config.productionTip=!1,new a["a"]({render:function(t){return t(et)}}).$mount("#app")},"5c0b":function(t,e,n){"use strict";var a=n("5e27"),r=n.n(a);r.a},"5e27":function(t,e,n){},"894b":function(t,e,n){"use strict";var a=n("a130"),r=n.n(a);r.a},"91fa":function(t,e,n){"use strict";var a=n("a90f"),r=n.n(a);r.a},a130:function(t,e,n){},a90f:function(t,e,n){},f203:function(t,e,n){"use strict";var a=n("0466"),r=n.n(a);r.a},f27d:function(t,e,n){"use strict";var a=n("0f8a"),r=n.n(a);r.a},fcd1:function(t,e,n){}});
//# sourceMappingURL=app.a857de09.js.map