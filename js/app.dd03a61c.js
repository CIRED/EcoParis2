(function(t){function e(e){for(var n,i,s=e[0],l=e[1],c=e[2],d=0,p=[];d<s.length;d++)i=s[d],r[i]&&p.push(r[i][0]),r[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(p.length)p.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],n=!0,s=1;s<a.length;s++){var l=a[s];0!==r[l]&&(n=!1)}n&&(o.splice(e--,1),t=i(i.s=a[0]))}return t}var n={},r={app:0},o=[];function i(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=n,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var u=l;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"0466":function(t,e,a){},"054f":function(t,e,a){"use strict";var n=a("fcd1"),r=a.n(n);r.a},"2a3c":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("cadf"),a("551c"),a("097d");var n=a("2b0e"),r=function(){var t=this,e=this,a=e.$createElement,n=e._self._c||a;return n("div",{attrs:{id:"app"}},[n("transition",{attrs:{name:"fade"}},[e.introVisible?n("Intro",{attrs:{onDismiss:function(){e.introVisible=!1,t.currentLayerPath=t.defaultLayer}}}):e._e()],1),n("section",{staticClass:"menu"},[n("LocationControl",{attrs:{onLocation:function(e){return t.currentLocation=e}}}),n("Layers",{attrs:{layers:e.layers},model:{value:e.currentLayerPath,callback:function(t){e.currentLayerPath=t},expression:"currentLayerPath"}}),n("ZoomControl")],1),n("section",{staticClass:"container"},[n("Map",{attrs:{layers:e.layers,currentLayerPath:e.currentLayerPath,currentLocation:e.currentLocation,onHist:function(e,a){t.currentHistogramX=e,t.currentHistogramY=a},onSchools:function(t){},appRefs:this.$refs}}),n("svg",{ref:"circle_svg",staticClass:"EV-circle-svg"}),n("svg",{ref:"svg",staticClass:"EV-svg"}),n("div",{ref:"legend",staticClass:"color_legend"}),n("Sidebar",{attrs:{layers:e.layers,currentLayerPath:e.currentLayerPath,EV_path:e.EV_path,currentHistogramX:e.currentHistogramX,currentHistogramY:e.currentHistogramY}})],1)],1)},o=[],i=(a("ac6a"),a("456d"),a("7dc5")),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"intro"},[t._m(0),a("p",[t._v("Découvrez l'influence de la nature sur votre vie à Paris.")]),a("section",{staticClass:"buttons"},[a("a",{staticClass:"button accent",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.onDismiss(e)}}},[t._v("Commencer")]),a("a",{staticClass:"button",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.onDismiss(e)}}},[t._v("Visite guidée")])])])},l=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h1",[t._v("\n    EcoParis\n    "),a("img",{attrs:{src:"assets/parrot.svg"}})])}],c={props:["onDismiss"]},u=c,d=(a("91fa"),a("2877")),p=Object(d["a"])(u,s,l,!1,null,null,null);p.options.__file="Intro.vue";var h=p.exports,f=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},m=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"zoom-control"},[a("a",{staticClass:"minus",attrs:{href:"#"}},[t._v("-")]),a("a",{staticClass:"plus",attrs:{href:"#"}},[t._v("+")])])}],v={},g=v,y=(a("bf1e"),Object(d["a"])(g,f,m,!1,null,null,null));y.options.__file="ZoomControl.vue";var _=y.exports,b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"location-control"},[a("a",{staticClass:"locate",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.locate(e)}}},[a("i",{staticClass:"fas fa-map-marker-alt"})]),a("div",{class:{search:!0,active:t.searchExpanded}},[a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.toggleSearch(e)}}},[t.searchExpanded?a("i",{staticClass:"fas fa-search-minus"}):a("i",{staticClass:"fas fa-search-location"})]),a("input",{ref:"searchInput",staticClass:"autocomplete",attrs:{type:"text"},on:{keyup:function(e){if(!("button"in e)&&27!==e.keyCode)return null;t.searchExpanded=!1}}})])])},C=[],E={props:["onLocation"],data:function(){return{searchExpanded:!1}},mounted:function(){var t=this,e=new google.maps.places.Autocomplete(this.$refs.searchInput);e.setFields(["geometry"]),e.setOptions({strictBounds:!0}),e.setBounds({north:i.viewport.topLatitude,south:i.viewport.bottomLatitude,west:i.viewport.leftLongitude,east:i.viewport.rightLongitude}),e.addListener("place_changed",function(){var a=e.getPlace();a.geometry?(t.searchExpanded=!1,t.onLocation([a.geometry.location.lat(),a.geometry.location.lng()])):t.onLocation(null,null)})},methods:{locate:function(){var t=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){t.onLocation([e.coords.latitude,e.coords.longitude])})},toggleSearch:function(){this.searchExpanded^=!0,this.$refs.searchInput.focus()},keypressSearch:function(t){alert(JSON.stringify(t))}}},x=E,P=(a("bed8"),Object(d["a"])(x,b,C,!1,null,null,null));P.options.__file="LocationControl.vue";var V=P.exports,w=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"layers"},[a("h3",[t._v("Couches")]),a("div",{staticClass:"buttons"},t._l(t.layers,function(e){return e.hidden?t._e():a("a",{class:{active:t.value==e.path},on:{click:function(a){a.preventDefault(),t.select(e)}}},[a("span",{staticClass:"icon",domProps:{innerHTML:t._s(e.icon)}}),a("span",[t._v(t._s(e.name))]),e.loaded?t._e():a("div",{staticClass:"loader-tile-grid"},[a("div",{staticClass:"loader-tile loader-tile1"}),a("div",{staticClass:"loader-tile loader-tile2"}),a("div",{staticClass:"loader-tile loader-tile3"}),a("div",{staticClass:"loader-tile loader-tile4"}),a("div",{staticClass:"loader-tile loader-tile5"}),a("div",{staticClass:"loader-tile loader-tile6"}),a("div",{staticClass:"loader-tile loader-tile7"}),a("div",{staticClass:"loader-tile loader-tile8"}),a("div",{staticClass:"loader-tile loader-tile9"})])])}))])},k=[],S={props:["layers","value"],methods:{select:function(t){t.loading||this.$emit("input",t.path)}}},j=S,I=(a("054f"),Object(d["a"])(j,w,k,!1,null,null,null));I.options.__file="Layers.vue";var T=I.exports,O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{ref:"map",staticClass:"map"})},B=[],H=a("3835"),D={},M="",$=null,z=null,G=null,A=null,F=null,R=null,Y=null,N=null,X=null,U={},q=null,J=null,Z=null,W=null,K=[],Q=null,tt=null,et=null,at=null,nt=null,rt=null,ot=null,it=-1,st=null,lt={},ct={cachedLayers:D,currentLayerPath:M,map:$,currentGeoLat:z,currentGeoLng:G,svg_EV:A,svg_circle_EV:F,interComms:R,voronoi:Y,imgs:N,imgs_EV:X,update_parameters:U,markerElement:q,canvas:J,voronoi_shape:Z,interComm_shape:W,firstVoronoiByInterComm:K,pathGenerator:Q,defs_path:tt,legend_element:et,color_legend_canvas:at,color_legend_svg:nt,onSchools:rt,onHistChange:ot,highlightedInterComm:it,initialBounds:st,markerIcon:lt},ut={0:d3.interpolateRdYlBu,1:d3.interpolateBuGn,2:d3.interpolateCool};function dt(t){return fetch(t).then(function(t){return t.json()}).then(function(t){return t.data=JSON.parse(t.data),t})}var pt="https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",ht='&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';function ft(t){ct.map=L.map(t,{zoomControl:!1});var e=ct.map;e.fitBounds(ct.initialBounds);var a=L.tileLayer(pt,{minZoom:9,maxZoom:14,attribution:ht});a.addTo(e)}function mt(t){return interComm_shape.features.some(function(e){return d3.geoContains(e,t)})}function vt(t,e){t&&e&&mt([e,t])?(ct.map.setZoom(11),ct.map.panTo(new L.LatLng(t,e))):(t=null,e=null,ct.map.fitBounds(ct.initialBounds)),ct.currentGeoLat=t,ct.currentGeoLng=e,update_f.updateMarker()}function gt(t){for(var e=ut[t],a=[],n=0;n<256;++n)a.push(e(n/255));return a}function yt(t,e,a,n,r){for(var o=200,i=80,s={top:10,right:40,bottom:10,left:2},l=t.attr("height",o-s.top-s.bottom).attr("width",1).style("height",o-s.top-s.bottom+"px").style("width",i-s.left-s.right+"px").style("border","1px solid #000").style("position","absolute").style("top",s.top+"px").style("left",s.left+"px").node(),c=l.getContext("2d"),u=function(t){return a((o-s.top-s.bottom-t)/(o-s.top-s.bottom)*255)},d=c.createImageData(1,o-s.top-s.bottom),p=0;p<o-s.top-s.bottom;++p){var h=d3.rgb(u(p));d.data[4*p]=h.r,d.data[4*p+1]=h.g,d.data[4*p+2]=h.b,d.data[4*p+3]=255}c.putImageData(d,0,0);var f=d3.axisRight().scale(d3.scaleLinear().domain([r,n]).range([1,o-s.bottom-s.top])).tickSize(6).ticks(8),m=e.attr("height",o+"px").attr("width",i+"px").style("position","absolute").style("left","0px").style("top","0px");m.select("g").attr("class","axis").attr("transform","translate("+(i-s.left-s.right+3)+","+s.top+")").call(f)}function _t(t,e){var a=t.slice();a.unshift(0),a.push(255);for(var n=a.length,r=e.length,o=[],i=0;i<r;++i)o[i]=i/(r-1);var s=d3.scale.linear().domain(o).range(e),l=[];for(i=0;i<n;++i){var c=i/(n-1);l.push(s(c))}return[a,l]}function Lt(t){return{opacity:0,fillOpacity:0}}function bt(t){for(var e=[],a=0;a<t;++a)e[a]=a;return e}var Ct={loadContainmentFile:dt,createMap:ft,setLocation:vt,getColorsFromScheme:gt,fillScale:yt,computeColorRange:_t,blankStyle:Lt,range:bt},Et=a("7dc5");function xt(){var t=ct.map,e=ct.cachedLayers,a=ct.currentLayerPath,n=ct.defs_path;function r(n,r){var o=t.latLngToLayerPoint([e[a].tl_lat,e[a].tl_lng]),i=t.latLngToLayerPoint([e[a].br_lat,e[a].br_lng]),s=i.x-o.x,l=i.y-o.y,c=t.latLngToLayerPoint(L.latLng(r,n)),u=(c.x-o.x)/(i.x-o.x)*(s-1),d=(c.y-o.y)/(i.y-o.y)*(l-1);this.stream.point(u,d)}var o=d3.geo.transform({point:r}),i=d3.geo.path().projection(o);n.attr("d",i)}function Pt(t,e){var a=ct.svg_EV,n=ct.map,r=ct.cachedLayers,o=ct.imgs_EV,i=Et.EV_path;if(r[Et.EV_path]){a.style("width").substr(0,a.style("width").length-2);var s=parseInt(a.style("width").substr(0,a.style("width").length-2)),l=parseInt(a.style("height").substr(0,a.style("width").length-2));a.attr("style","top:"+(e-l-30)+"; left:"+(t-s/2)+"; display:'';"),ct.svg_circle_EV.attr("style","top:"+(e-l/2)+"; left:"+(t-s/2)+"; display:'';");var c=L.latLng(r[i].tl_lat,r[i].tl_lng),u=L.latLng(r[i].br_lat,r[i].br_lng),d=n.latLngToContainerPoint(c),p=(n.latLngToContainerPoint(u),n.latLngToLayerPoint(u).x-n.latLngToLayerPoint(c).x),h=n.latLngToLayerPoint(u).y-n.latLngToLayerPoint(c).y;o.attr("width",p),o.attr("height",h),o.attr("transform","translate("+(+d.x-t+s/2)+","+(+d.y-e+l/2)+")")}}function Vt(t,e,a){var n=ct.cachedLayers,r=n[e];if(r){var o=[];o=1==a?r.voronoi_hist[t]:r.interComm_hist[t],o[0]=0,ct.onHistChange(Ct.range(256),o)}}function wt(t,e,a){var n=ct.cachedLayers;if(e==Et.Urban_cooling){var r=n[Et.Ecole_path];if(!r)return;var o=[];o=1==a?r.voronoi_hist[t]:r.interComm_hist[t],ct.onSchools(o)}else ct.onSchools(null)}function kt(){var t=ct.map,e=ct.currentGeoLat,a=ct.currentGeoLng,n=ct.markerElement;if(e&&a){var r=t.latLngToLayerPoint([e,a]),o=r.x-ct.markerIcon.iconAnchor[0],i=r.y-ct.markerIcon.iconAnchor[1];n.attr("visibility","visible"),n.attr("transform","translate(".concat(o,", ").concat(i,")"))}else n.attr("visibility","hidden")}function St(){var t=ct.map,e=(ct.cachedLayers,ct.voronoi),a=ct.interComms,n=ct.imgs,r=ct.imgs_EV,o=ct.update_parameters,i=ct.pathGenerator;if(o.hide)return console.log("hidden!"),a.attr("visibility","hidden"),e.attr("visibility","hidden"),n.attr("visibility","hidden"),void r.attr("visibility","hidden");a.attr("visibility","visible"),e.attr("visibility","visible"),n.attr("visibility","visible"),r.attr("visibility","visible");var s=o.tl,l=o.br;console.log("UPDATING");var c=t.latLngToLayerPoint(l).x-t.latLngToLayerPoint(s).x,u=t.latLngToLayerPoint(l).y-t.latLngToLayerPoint(s).y;n.attr("transform",function(e){var a=t.latLngToLayerPoint(s);return"translate("+a.x+","+a.y+")"}),n.attr("width",c),n.attr("height",u),a.attr("d",i),e.attr("d",i),xt(),kt(),ct.svg_EV.attr("style","display:none;"),ct.svg_circle_EV.attr("style","display:none;")}var jt={update_clip:xt,update_EV_preview:Pt,update_chart:Vt,update_text_school:wt,updateMarker:kt,updateMap:St},It=a("7dc5");function Tt(t,e){var a=ct.canvas,n=ct.voronoi_shape,r=ct.interComm_shape;ct.cachedLayers[t]?e():fetch(t).then(function(t){return t.json()}).then(function(o){o.data=JSON.parse(o.data),o.percentiles=JSON.parse(o.percentiles);var i=o.data;a.width=o.width,a.height=o.height;var s=a.getContext("2d");s.createImageData(a.width,a.height);for(var l=a.height*a.width,c=1,u=0,d=l/c,p=a.height/c,h=[],f=[],m={},v=0;v<n.features.length;++v){f[v]=0,h[v]=0,m[v]=[];for(var g=0;g<256;++g)m[v][g]=0}var y=[],_=[],L={};for(v=0;v<r.features.length;++v){_[v]=0,y[v]=0,L[v]=[];for(g=0;g<256;++g)L[v][g]=0}ct.firstVoronoiByInterComm=[];var b=ct.firstVoronoiByInterComm;for(v=0;v<r.features.length;++v)b[v]=1e4;var C=function(i){for(var l=i.data.result,d=i.data.index,v=i.data.interComm_counts,g=i.data.interComm_means,C=i.data.voronoi_counts,E=i.data.voronoi_means,x=i.data.firstVoronoiByInterComm,P=i.data.voronoi_hist,V=i.data.interComm_hist,w=0;w<n.features.length;++w){f[w]+=C[w],h[w]+=E[w];for(var k=0;k<256;++k)m[w][k]+=P[w][k]}for(w=0;w<r.features.length;++w){_[w]+=v[w],y[w]+=g[w];for(k=0;k<256;++k)L[w][k]+=V[w][k];b[w]>x[w]&&(b[w]=x[w])}if(s.putImageData(l,0,p*d),u++,u==c){if(t==It.Ecole_path){for(w=0;w<n.features.length;++w)h[w]/=255;for(w=0;w<r.features.length;++w)y[w]/=255}else{for(w=0;w<n.features.length;++w)0!=f[w]&&(h[w]/=f[w]);for(w=0;w<r.features.length;++w)0!=_[w]&&(y[w]/=_[w])}var S=[70,140],j=a.toDataURL("png");ct.cachedLayers[t]={url:j,tl_lat:o.tl_lat,tl_lng:o.tl_lng,br_lat:o.br_lat,br_lng:o.br_lng,width:a.width,height:a.height,voronoi_means:h,interComm_means:y,voronoi_hist:m,interComm_hist:L,hist_buckets:S,percentiles:o.percentiles,layerUrl:t},e()}},E=Ct.range(256),x=[];if(It.layers[t].useColorScheme)x=Ct.getColorsFromScheme(It.layers[t].colorScheme);else{var P=Ct.computeColorRange(o.percentiles,It.layers[t].colors),V=P[0],w=P[1],k=d3.scale.linear().range(w).domain(V);for(v=0;v<256;++v){var S=d3.rgb(k(v));x.push("rgb("+S.r+","+S.g+","+S.b+")")}}Ct.loadContainmentFile("data/voronoi_cont.json").then(function(t){Ct.loadContainmentFile("data/intercomm_cont.json").then(function(e){for(var l=0;l<c;l++){var u=new Worker("assets/pictureProcessor.js");u.onmessage=C;var h=s.getImageData(0,p*l,a.width,p);u.postMessage({canvasData:h,pixels:i,index:l,length:d,width:a.width,height:a.height,voronoiContainmentData:t.data,interCommContainmentData:e.data,numVoronois:n.features.length,numInterComms:r.features.length,tl_lat:o.tl_lat,tl_lng:o.tl_lng,br_lat:o.br_lat,br_lng:o.br_lng,colorDomain:E,colorRange:x})}})})})}function Ot(t){var e=ct.update_parameters,a=ct.imgs;if(!t)return e.hide=!0,void jt.updateMap();this.loadLayer(t,function(){t==It.EV_path?a.attr("clip-path",""):a.attr("clip-path","url(#clip)");var n=ct.cachedLayers[t];e.tl=new L.LatLng(n.tl_lat,n.tl_lng),e.br=new L.LatLng(n.br_lat,n.br_lng),e.currentGeoLat=ct.currentGeoLat,e.currentGaoLng=ct.currentGeoLng;var r=[],o=[];if(It.layers[t].useColorScheme)r=Ct.range(256),o=Ct.getColorsFromScheme(It.layers[t].colorScheme);else{var i=Ct.computeColorRange(n.percentiles,It.layers[t].colors);r=i[0],o=i[1]}var s=d3.scale.linear().range(o).domain(r);ct.voronoi.attr("fill",function(e,a){return t==It.EV_path?"#00000011":s(n.voronoi_means[a])}),ct.interComms.attr("fill",function(e,a){return t==It.EV_path?"#00000011":s(n.interComm_means[a])}),ct.canvas.width=n.width,ct.canvas.height=n.height,e.hide=!1,jt.updateMap(),ct.currentLayerPath=t,a.attr("xlink:href",n.url),t==It.EV_path?d3.select(ct.legend_element).style("display","none").style("border","1px solid #0000"):(Ct.fillScale(ct.color_legend_canvas,ct.color_legend_svg,s,It.layers[t].min_value,It.layers[t].max_value),d3.select(ct.legend_element).style("background-color","#fff"),d3.select(ct.legend_element).style("display","").style("border","1px solid #000"))})}function Bt(t){ct.imgs_EV.attr("xlink:href",ct.cachedLayers[It.EV_path].url)}var Ht={loadLayer:Tt,setLayer:Ot,setEVLayer:Bt},Dt=a("7dc5");function Mt(t){function e(e,a){return ct.firstVoronoiByInterComm[t]<=a&&(t==ct.interComm_shape.features.length-1||ct.firstVoronoiByInterComm[t+1]>a)?1:0}return e}function $t(t,e,a){return t.append("g").selectAll("path").data(ct.voronoi_shape.features).enter().append("path").attr("d",ct.pathGenerator).attr("vector-effect","non-scaling-stroke").style("stroke","#666").style("fill-opacity",e).style("stroke-opacity",e).on("mouseover",function(t,a){d3.select(this).style("fill-opacity",e),ct.defs_path.datum(t.geometry),jt.update_clip(),jt.update_chart(a,ct.currentLayerPath,!0,ct.onHistChange),jt.update_text_school(a,ct.currentLayerPath,!1,ct.onSchools)}).on("mouseout",function(t,e){-1!=ct.highlightedInterComm&&(d3.select(this).style("fill-opacity",Mt(ct.highlightedInterComm)(t,e)),d3.select(this).style("stroke-opacity",Mt(ct.highlightedInterComm)(t,e))),ct.defs_path.datum([]),jt.update_clip(),ct.svg_EV.attr("style","display:none;"),ct.svg_circle_EV.attr("style","display:none;")}).on("click",function(t,n){ct.interComms.style("pointer-events","all"),ct.map.fitBounds(ct.initialBounds),ct.highlightedInterComm=-1,ct.interComms.style("fill-opacity",a),ct.voronoi.style("fill-opacity",e),ct.voronoi.style("stroke-opacity",e),ct.defs_path.datum([]),jt.update_clip(),ct.svg_EV.attr("style","display:none;"),ct.svg_circle_EV.attr("style","display:none;")}).on("mousemove",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&ct.currentLayerPath!=Dt.EV_path?jt.update_EV_preview(d3.event.layerX,d3.event.layerY):(ct.svg_EV.attr("style","display:none;"),ct.svg_circle_EV.attr("style","display:none;"))})}function zt(t,e,a,n){return t.append("g").selectAll("path").data(ct.interComm_shape.features).enter().append("path").attr("d",ct.path).attr("vector-effect","non-scaling-stroke").style("stroke","#333").attr("fill","#fff").attr("fill-opacity",n).style("pointer-events","all").on("mouseover",function(t,r){-1!=ct.highlightedInterComm?r!=ct.highlightedInterComm?d3.select(this).style("fill-opacity",n):d3.select(this).style("fill-opacity",e):d3.select(this).style("fill-opacity",a),console.log(r),jt.update_chart(r,ct.currentLayerPath,!0),jt.update_text_school(r,ct.currentLayerPath,!1)}).on("mouseout",function(t,r){-1!=ct.highlightedInterComm?r==ct.highlightedInterComm?d3.select(this).style("fill-opacity",e):d3.select(this).style("fill-opacity",a):d3.select(this).style("fill-opacity",n),ct.svg_EV.attr("style","display:none;"),ct.svg_circle_EV.attr("style","display:none;")}).on("click",function(t,n){ct.interComms.style("pointer-events","all"),d3.select(this).style("pointer-events","none"),ct.interComms.style("fill-opacity",a),d3.select(this).style("fill-opacity",e),ct.highlightedInterComm=n,ct.voronoi.style("fill-opacity",Mt(n)),ct.voronoi.style("stroke-opacity",Mt(n));var r=d3.select(this).node().getBBox(),o=ct.map.layerPointToLatLng(L.point(r.x,r.y)),i=ct.map.layerPointToLatLng(L.point(r.x+r.width,r.y+r.height));ct.map.fitBounds(L.latLngBounds(o,i)),ct.svg_EV.attr("style","display:none;"),ct.svg_circle_EV.attr("style","display:none;")}).on("mousemove",function(){d3.event&&d3.event.clientX&&d3.event.clientY&&ct.currentLayerPath!=Dt.EV_path?jt.update_EV_preview(d3.event.layerX,d3.event.layerY):(ct.svg_EV.attr("style","display:none;"),ct.svg_circle_EV.attr("style","display:none;"))})}var Gt={defineVoronoi:$t,defineInterComms:zt},At=function(t,e,a,n,r,o,s,l,c){ct.interComm_shape=o,ct.voronoi_shape=s,ct.onHistChange=l,ct.onSchools=c,ct.legend_element=n;var u=new L.LatLng(i.viewport.topLatitude,i.viewport.leftLongitude),d=new L.LatLng(i.viewport.bottomLatitude,i.viewport.rightLongitude);function p(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){Ct.setLocation(t.coords.latitude,t.coords.longitude)})}ct.initialBounds=L.latLngBounds(u,d),ct.color_legend_canvas=d3.select(n).append("canvas"),ct.color_legend_svg=d3.select(n).append("svg"),ct.color_legend_svg.append("g"),p(),Ct.createMap(t),L.geoJson(o,{style:Ct.blankStyle}).addTo(ct.map);var h=d3.select(t).select(".leaflet-zoom-animated");function f(t,e){var a=ct.map.latLngToLayerPoint(new L.LatLng(e,t));this.stream.point(a.x,a.y)}var m=d3.geo.transform({point:f});ct.pathGenerator=d3.geo.path().projection(m);var v=h.append("defs");ct.defs_path=v.append("path").attr("id","clip_path"),v.append("clipPath").attr("id","clip").append("use").attr("xlink:href","#clip_path"),ct.imgs=h.selectAll("image").data([0]).enter().append("svg:image").attr("x",0).attr("y",0).attr("xlink:href","").attr("clip-path",""),jt.update_clip();var g=0,y=.4,_=1;ct.svg_EV=d3.select(e).attr("style","display:none;"),ct.svg_circle_EV=d3.select(a).attr("style","display:none;"),ct.imgs_EV=ct.svg_EV.selectAll("image").data([0]).enter().append("svg:image").attr("x",0).attr("y",0).attr("xlink:href","");var b=ct.svg_EV.append("g");return b.selectAll("path").data([o.features[0]]).enter().append("path").attr("vector-effect","non-scaling-stroke").style("stroke","#000").style("fill-opacity",0).style("stroke-opacity",1),ct.voronoi=Gt.defineVoronoi(h,g,_),ct.interComms=Gt.defineInterComms(h,g,y,_),ct.markerIcon={iconUrl:"assets/marker.png",iconSize:[24,24],iconAnchor:[12,24]},ct.markerElement=h.append("g").selectAll("image").data([0]).enter().append("svg:image").attr("xlink:href",ct.markerIcon.iconUrl).attr("width",ct.markerIcon.iconSize[0]).attr("height",ct.markerIcon.iconSize[1]).attr("visibility","hidden").style("pointer-events","none"),ct.canvas=document.createElement("canvas"),ct.update_parameters={hide:!0},ct.map.on("viewreset",function(){jt.updateMap()}),[Ht.loadLayer,Ht.setLayer,Ct.setLocation,Ht.setEVLayer]},Ft={props:["layers","currentLayerPath","currentLocation","onHist","onSchools","appRefs","onSchools"],data:function(){return{loadLayer:function(){},setLayer:function(){},setLocation:function(){}}},mounted:function(){var t=this,e="data/intercommunalites.geojson",a="data/voronois.json";queue().defer(d3.json,e).defer(d3.json,a).await(function(e,a,n){var r=At(t.$refs.map,t.appRefs.svg,t.appRefs.circle_svg,t.appRefs.legend,e,a,n,t.onHist,t.onSchools),o=Object(H["a"])(r,5);t.loadLayer=o[0],t.setLayer=o[1],t.setLocation=o[2],t.setEVLayer=o[3],t.setTextUrban=o[4],Object.keys(i.layers).forEach(function(e){t.layers[e].path=e,t.loadLayer(e,function(){t.layers[e].loaded=!0,e==i.EV_path&&t.setEVLayer(e)})}),t.setLayer(t.currentLayerPath)})},watch:{currentLayerPath:function(t){this.setLayer(t)},currentLocation:function(t){var e=Object(H["a"])(t,2),a=e[0],n=e[1];this.setLocation(a,n)}}},Rt=Ft,Yt=(a("894b"),Object(d["a"])(Rt,O,B,!1,null,null,null));Yt.options.__file="Map.vue";var Nt=Yt.exports,Xt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"sidebar"},[t.currentLayerPath&&t.layers[t.currentLayerPath].loaded?a("div",[a("h2",[t._v(t._s(t.layers[t.currentLayerPath].title))]),a("div",{domProps:{innerHTML:t._s(t.layers[t.currentLayerPath].content)}}),t.currentLayerPath!=t.EV_path?a("Histogram",{attrs:{x:t.currentHistogramX,y:t.currentHistogramY}}):t._e()],1):a("div",{staticClass:"split"},[t._m(0),t._m(1)])])},Ut=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("article",[a("h2",[t._v("Bienvenue sur EcoParis.")]),a("p",[t._v("EcoParis est une visualisation interactive des données cartographiques des services écosystémiques en territoires urbains et péri-urbains en région Ile-de-France issues du projet "),a("a",{attrs:{href:"https://idefese.wordpress.com/"}},[t._v("IDEFESE")]),t._v(".")]),a("p",[t._v("Pour commencer, vous pouvez sélectionner une couche à afficher parmi des mesures de rétention "),a("a",{attrs:{href:"#"}},[t._v("de phosphore")]),t._v(" et "),a("a",{attrs:{href:"#"}},[t._v("d'azote")]),t._v(", des mesures de "),a("a",{attrs:{href:"#"}},[t._v("réduction de la température")]),t._v(" due à la végétation ou encore de "),a("a",{attrs:{href:"#"}},[t._v("valeur économique")]),t._v(" des régions.")]),a("p",[t._v("Vous pouvez aussi choisir d'afficher l'évolution estimée de ces mesures à l'horizon 2025 dans un scénario de changement climatique.")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("article",{staticClass:"about"},[a("p",[t._v("EcoParis a été conçu par des élèves du cours de "),a("a",{attrs:{href:"https://edu.epfl.ch/coursebook/en/data-visualization-COM-480"}},[t._v("Data Visualization")]),t._v(" de l'EPFL, avec l'aide de Perrine Hamel du projet "),a("a",{attrs:{href:"https://naturalcapitalproject.stanford.edu/"}},[t._v("Natural Capital Project")]),t._v(" de Stanford.")]),a("section",{staticClass:"slideshow"},[a("a",{attrs:{href:"https://www.epfl.ch/"}},[a("img",{attrs:{src:"https://mediacom.epfl.ch/files/content/sites/mediacom/files/EPFL-Logo.jpg",alt:"Logo EPFL"}})]),a("a",{attrs:{href:"https://naturalcapitalproject.stanford.edu/"}},[a("img",{attrs:{src:"https://idefese.files.wordpress.com/2018/11/image5.jpg?w=172&h=171",alt:"Logo NatCap"}})])])])}],qt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"graph",staticClass:"graph-box"})},Jt=[],Zt=function(t){Plotly.react(t.$refs.graph,[{x:t.x,y:t.y,type:"histogram",histfunc:"sum",xbins:{end:256,size:1,start:0}}],{margin:{l:35,r:35,t:5,b:20}},{displayModeBar:!1})},Wt={props:["x","y"],mounted:function(){Zt(this)},watch:{x:function(){Zt(this)}}},Kt=Wt,Qt=(a("cd26"),Object(d["a"])(Kt,qt,Jt,!1,null,null,null));Qt.options.__file="Histogram.vue";var te=Qt.exports,ee={props:["layers","currentLayerPath","EV_path","currentHistogramX","currentHistogramY"],components:{Histogram:te}},ae=ee,ne=(a("f203"),Object(d["a"])(ae,Xt,Ut,!1,null,null,null));ne.options.__file="Sidebar.vue";var re=ne.exports,oe=i.EV_path,ie={data:function(){return{layers:Object.keys(i.layers).reduce(function(t,e){return t[e]=i.layers[e],t[e].loaded=!1,t[e].path=e,t},{}),currentLayerPath:null,currentLocation:null,currentHistogramX:null,currentHistogramY:null,introVisible:!0,sidebarVisible:!1,defaultLayer:oe,EV_path:i.EV_path}},components:{Intro:h,ZoomControl:_,LocationControl:V,Layers:T,Map:Nt,Sidebar:re}},se=ie,le=(a("5c0b"),Object(d["a"])(se,r,o,!1,null,null,null));le.options.__file="App.vue";var ce=le.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(t){return t(ce)}}).$mount("#app")},"58be":function(t,e,a){},"5c0b":function(t,e,a){"use strict";var n=a("5e27"),r=a.n(n);r.a},"5e27":function(t,e,a){},"7dc5":function(t){t.exports={layers:{"data/rasters/espaces_verts.json":{name:"Esp. verts",icon:"E",colorScheme:0,useColorScheme:!1,colors:["#00ff00","#0000ff","#008800"],min_value:0,max_value:0,title:"Espaces verts.",content:"<p>[texte espaces verts]</p>"},"data/rasters/pollination_cc.json":{name:"Phosph.",icon:"P",colorScheme:1,useColorScheme:!0,min_value:0,max_value:5,title:"Mesure de la rétention de phosphore.",content:"<p>Le service de rétention du phosphore permet d'améliorer la qualité de l'eau (superficielle et souterraine). Il est directement utile aux organismes de gestion de l'eau (syndicats et département d'assainissement), et donc aux habitants dont les impôts financent la maintenance des services d'assainissement.</p>"},"data/rasters/T_reduction.json":{name:"Nitrog.",icon:"N",colorScheme:0,useColorScheme:!0,min_value:-5,max_value:5,title:"Mesure de la rétention d'azote.",content:"<p>Le service de rétention de l'azote permet d'améliorer la qualité de l'eau (superficielle et souterraine). Il est directement utile aux organismes de gestion de l'eau (syndicats et département d'assainissement), et donc aux habitants dont les impôts financent la maintenance des services d'assainissement.</p>"},"data/rasters/ecoles_elementaires.json":{name:"Ecoles elementaires",icon:"E",colorScheme:0,useColorScheme:!0,min_value:0,max_value:0,title:"Nombre d'écoles élémentaires et maternelles",content:"<p>Should not appear anyway, find something to fill here.</p>",hidden:!0}},viewport:{topLatitude:49.23719070644322,bottomLatitude:48.12054154281846,leftLongitude:1.44727950476602,rightLongitude:3.555686958558566},EV_path:"data/rasters/espaces_verts.json",Ecole_path:"data/rasters/ecoles_elementaires.json",Urban_cooling:"data/rasters/T_air_ref.json","":"1 - blue-green"}},"894b":function(t,e,a){"use strict";var n=a("a130"),r=a.n(n);r.a},"91fa":function(t,e,a){"use strict";var n=a("a90f"),r=a.n(n);r.a},a130:function(t,e,a){},a90f:function(t,e,a){},bed8:function(t,e,a){"use strict";var n=a("2a3c"),r=a.n(n);r.a},bf1e:function(t,e,a){"use strict";var n=a("d162"),r=a.n(n);r.a},cd26:function(t,e,a){"use strict";var n=a("58be"),r=a.n(n);r.a},d162:function(t,e,a){},f203:function(t,e,a){"use strict";var n=a("0466"),r=a.n(n);r.a},fcd1:function(t,e,a){}});
//# sourceMappingURL=app.dd03a61c.js.map